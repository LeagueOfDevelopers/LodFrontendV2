"use strict";angular.module("LodSite",["ng","ngRoute","ui.router","ngDialog","base64","LodSite.directives","LodSite.controllers","LodSite.services"]).run(function(){FastClick.attach(document.body),$(window).resize(setPaddingBottom)}).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,t,n){e.hashPrefix("!"),e.html5Mode(!0),n.otherwise("/"),t.state("index",{url:"/",templateUrl:templateUrl("index","index"),controller:"IndexCtrl"}).state("login-github",{url:"/login/github/:encodedToken",template:"<ui-view>",controller:"GithubLoginCtrl"}).state("projects",{url:"/projects",template:"<ui-view/>",abstract:!0}).state("projects.index",{url:"",templateUrl:templateUrl("projects","projects-index"),controller:"FullProjectsCtrl"}).state("projects.item",{url:"/:id",templateUrl:templateUrl("projects","projects-item"),controller:"ProjectCtrl"}).state("developers",{url:"/developers",template:"<ui-view/>",abstract:!0}).state("developers.index",{url:"",templateUrl:templateUrl("developers","developers-index"),controller:"FullDevelopersCtrl"}).state("developers.item",{url:"/:id",templateUrl:templateUrl("developers","developers-item"),controller:"DeveloperCtrl"}).state("developers.confirmation",{url:"/confirmation/:token",templateUrl:templateUrl("developers","developers-confirmation"),controller:"EmailConfirmationCtrl"}).state("developers.edit",{url:"/profile/:id",templateUrl:templateUrl("developers","developers-edit"),controller:"DeveloperEditCtrl"}).state("adminpanel",{url:"/admin",template:"<ui-view/>",abstract:!0}).state("adminpanel.index",{url:"",templateUrl:templateUrl("adminpanel","adminpanel-index"),controller:"AdminPanelCtrl"}).state("adminpanel.projects",{url:"/projects",templateUrl:templateUrl("adminpanel","adminpanel-projects"),controller:"AllProjectsCtrl"}).state("adminpanel.projectAdd",{url:"/projects/add",templateUrl:templateUrl("adminpanel","adminpanel-projectAdd"),controller:"AddProjectCtrl"}).state("adminpanel.projectEdit",{url:"/projects/edit/:id",templateUrl:templateUrl("adminpanel","adminpanel-projectEdit"),controller:"EditProjectCtrl"}).state("adminpanel.notification",{url:"/notification",templateUrl:templateUrl("adminpanel","adminpanel-notification"),controller:"AdminNotificationCtrl"}).state("adminpanel.developers",{url:"/developers",templateUrl:templateUrl("adminpanel","adminpanel-developers"),controller:"AdminDevelopersCtrl"}).state("signup",{url:"/signup",templateUrl:templateUrl("signup","signup-index"),controller:"SignupCtrl"}).state("about",{url:"/about",templateUrl:templateUrl("about","about-index"),controller:"AboutCtrl"}).state("contact",{url:"/contact",templateUrl:templateUrl("contact","contact-index"),controller:"ContactCtrl"}).state("notifications",{url:"/notifications",templateUrl:templateUrl("notifications","notifications-index"),controller:"NotificationsCtrl"}).state("password-recovery",{url:"/password/recovery/:token",templateUrl:templateUrl("passwordRecovery","passwordRecovery-index"),controller:"PasswordRecoveryCtrl"})}]);var DOMAIN_NAME="lod-misis.ru",DOMAIN_URL="https://"+DOMAIN_NAME,API_DOMAIN_URL="https://api."+DOMAIN_NAME,numberOfProjects=null;function templateUrl(e,t){return"app/templates/"+e+"/"+t+".html?"+Math.random()}function getDevsSectionAmount(){var e=4,t=$(window).width();return t<=640?e=4:t>640&&t<=890?e=4:t>890&&t<=1230?e=6:t>1230&&t<=1520?e=4:t>1520&&t<=1810&&(e=5),e}function getProjsSectionAmount(){var e=4,t=$(window).width();return t<=1e3?e=3:t>1e3&&t<=1300?e=4:t>1300&&t<=1700?e=3:t>1700&&t<=2e3&&(e=4),e}function setPaddingBottom(){angular.element(".content").css("padding-bottom",$("footer").innerHeight())}setPaddingBottom(),setTimeout(setPaddingBottom,3e3),angular.module("LodSite.controllers",[]).controller("PageCtrl",["$scope","$rootScope",function(e,t){t.dataLoading=null,e.DEFAULT_PROJECT_LANDSCAPE="/app/imgs/project-cap-image.png",e.DEFAULT_DEVELOPER_PHOTO="/app/imgs/developer-default-photo.png",t.$on("userRole_changed",function(t,n){e.userRole=n.userRole}),e.$on("change_title",function(t,n){e.title=void 0!==n.title&&n.title.length?n.title:"Лига Разработчиков НИТУ МИСиС"}),e.$on("$viewContentLoaded",setPaddingBottom),e.$on("$locationChangeSuccess",function(){angular.element(window).scrollTop(0)})}]).controller("AppCtrl",["$scope",function(e){e.isBlack=!1,e.$on("toggle_black",function(t,n){e.isBlack=!!n&&n.isBlack})}]).controller("IndexCtrl",["$scope",function(e){e.$emit("change_title",{title:"Лига Разработчиков НИТУ МИСиС"}),e.$emit("toggle_black")}]).controller("HeaderCtrl",["$scope","ngDialog","TokenService","$state","NotificationsService","$rootScope",function(e,t,n,o,r,i){e.isOpened=!1;var a=n.getToken();a&&(e.userId=a.UserId),e.activeToggle=function(){e.isOpened=!e.isOpened},e.openLoginDialog=function(){e.$dialog=t.open({template:"loginTemplate",showClose:!0,closeByNavigation:!0}),this.activeToggle()},e.signOut=function(){n.resetToken(),n.getRole(),r.stopShowNotificationsAmount(),o.reload()},n.getToken()&&r.startShowNotificationsAmount(),e.$on("$locationChangeSuccess",function(){e.isOpened=!1}),i.$on("userRole_changed",function(t,o){(a=n.getToken())&&(e.userId=a.UserId)})}]).controller("FooterCtrl",["$scope",function(e){e.currentDate=new Date}]).controller("RandomDevelopersCtrl",["$scope","ApiService",function(e,t){var n=getDevsSectionAmount();t.getRandomDevelopers(n).then(function(t){e.randomDevelopers=t})}]).controller("FullDevelopersCtrl",["$scope","ApiService",function(e,t){e.searchText="",e.fullDevelopers=[],e.isMoreDevs=!0;var n=0;e.resetPageCounter=function(){n=0},e.addDevelopers=function(){n++,t.getFullDevelopers(n).then(function(t){t&&0!==t.Data.length?(e.fullDevelopers=e.fullDevelopers.concat(t.Data),e.isMoreDevs=e.fullDevelopers.length<t.CountOfEntities):e.isMoreDevs=!1})},e.$watch("searchText",function(o,r){""===o?(e.resetPageCounter(),t.getFullDevelopers(n).then(function(t){e.fullDevelopers=t.Data,e.isMoreDevs=e.fullDevelopers.length<t.CountOfEntities})):o!==r&&t.getFullDevelopersBySearch(e.searchText).then(function(t){e.isMoreDevs=!1,e.fullDevelopers=t})}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Разработчики - Лига Разработчиков НИТУ МИСиС"})}]).controller("DeveloperCtrl",["$scope","$state","ApiService",function(e,t,n){var o=t.params.id;n.getDeveloper(o).then(function(t){e.status=t.status,t.status?(e.developer=t.data,e.$emit("change_title",{title:e.developer.FirstName+" "+e.developer.LastName+" - Лига Разработчиков НИТУ МИСиС"})):e.$emit("change_title",{title:"404 Not found - Лига Разработчиков НИТУ МИСиС"})}),e.$emit("toggle_black",{isBlack:!0})}]).controller("DeveloperEditCtrl",["$scope","$state","$timeout","ApiService","TokenService",function(e,t,n,o,r){var i=r.getToken();if(!i)return t.go("index");var a=i.UserId;e.state=[],e.currentState=null,e.profile={};var s=function(){e.state=[],e.repeatedPassword=null,e.newPassword=null,e.profileSettingsForm.$setPristine(),n(function(){e.currentState=null},5e3)},c=function(){for(var t=0;t<3;t++)if(!e.state[t])return;for(t=0;t<3;t++)if("failed"==e.state[t])return e.currentState="failed",void s();e.currentState="success",s()};e.currentUploadStateBigPhoto="waiting",e.currentPercentBigPhoto=0,e.$on("beforeSendBigImage",function(t,n){e.currentUploadStateBigPhoto="uploading",e.currentPercentBigPhoto=0,e.$apply()}),e.$on("errorUploadingBigImage",function(t,n){alert("Размер файла не должен превышать 10 Мб. Разрешённые форматы изображения: JPG, JPEG, PNG, SVG, BMP, GIF. Или, возможно, вы не авторизовались."),e.currentUploadStateBigPhoto="waiting",e.currentPercentBigPhoto=0,e.$apply()}),e.$on("progressBigImage",function(t,n){e.currentPercentBigPhoto=n.progress_value,e.$apply()}),e.$on("successUploadingBigImage",function(t,n){e.profile.Image={BigPhotoUri:"https://api.lod-misis.ru/image/"+n.data.BigPhotoName,SmallPhotoUri:"https://api.lod-misis.ru/image/"+n.data.SmallPhotoName},e.currentUploadStateBigPhoto="waiting",e.$apply()}),e.deleteBigPhoto=function(){e.profile.Image=null},e.toggleNotifications=function(t){e.notifications[t]=!e.notifications[t]},o.getDeveloperForProfileSttings(a).then(function(t){e.profile.Image={BigPhotoUri:t.PhotoUri,SmallPhotoUri:t.PhotoUri},e.profile.InstituteName=t.InstituteName,e.profile.StudyingDirection=t.StudyingDirection,e.profile.Specialization=t.Specialization,e.profile.StudentAccessionYear=t.StudentAccessionYear,e.profile.LinkToGithubProfile=t.LinkToGithubProfile,e.profile.VkProfileUri=t.VkProfileUri,e.profile.PhoneNumber=t.PhoneNumber,e.profile.IsGraduated=t.IsGraduated}),o.getNotificationsForProfileSttings(a).then(function(t){e.notificationSettings=t,e.notifications=t.map(function(e){return 2==e.NotificationSettingValue})}),e.getRedirectionToAuthenticationGithubForm=function(){o.getRedirectionToAuthenticationGithubForm().then(function(t){e.state[0]=t?"success":"failed",c()})},e.changeProfileSettings=function(){o.sendProfileSttings(a,e.profile).then(function(t){e.state[0]=t?"success":"failed",c()});for(var t=0;t<e.notificationSettings.length;t++)e.notificationSettings[t].NotificationSettingValue=e.notifications[t]?2:1;o.sendNotifications(a,e.notificationSettings).then(function(t){e.state[1]=t?"success":"failed",c()}),e.newPassword&&e.repeatedPassword?o.sendNewPassword({NewPassword:e.newPassword,Token:i.Token}).then(function(t){e.state[2]=t?"success":"failed",c()}):(e.state[2]="success",c())},e.$on("userRole_changed",function(e,n){if(!(i=r.getToken())||!i.UserId)return t.go("index")}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Редактирование профиля - Лига Разработчиков НИТУ МИСиС"})}]).controller("RandomProjectsCtrl",["$scope","ApiService",function(e,t){var n=getProjsSectionAmount();t.getRandomProjects(n).then(function(t){e.randomProjects=t})}]).controller("FullProjectsCtrl",["$scope","ApiService",function(e,t){e.categories=[{category:"Веб",status:!1,index:0},{category:"Мобильное",status:!1,index:1},{category:"Десктопное",status:!1,index:2},{category:"Игра",status:!1,index:3},{category:"Прочее",status:!1,index:4}],e.fullProjects=[],e.isMoreProjects=!0;var n=0;e.resetPageCounter=function(){n=0},e.resetFullProjects=function(){e.fullProjects=[]},e.addProjects=function(){n++,e.updateProjects()},e.toggleCategory=function(t){t.status=!t.status,e.resetPageCounter(),e.resetFullProjects(),e.updateProjects()},e.updateProjects=function(){var o={},r=e.categories.filter(function(e){return e.status}).map(function(e){return e.index});r.length&&angular.extend(o,{categories:r.join(",")}),t.getFullProjects(o,n).then(function(t){t&&0!==t.Data.length?(e.fullProjects=e.fullProjects.concat(t.Data),e.isMoreProjects=e.fullProjects.length<t.CountOfEntities):e.isMoreProjects=!1})},e.updateProjects(),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Проекты - Лига Разработчиков НИТУ МИСиС"})}]).controller("ProjectCtrl",["$scope","$state","ApiService","ngDialog","$rootScope","TokenService",function(e,t,n,o,r,i){var a=t.params.id,s=i.getToken();if(e.openViewer=function(){e.$dialog=o.open({template:"viewer",showClose:!0,closeByNavigation:!0,controller:["$rootScope","$scope",function(e,t){t.openedScreenshotUrl=e.openedScreenshot.BigPhotoUri}]})},e.joinToProject=function(){n.joinToProject(a,c,JSON.stringify(e.projectDeveloperRole)).then(function(){t.reload()})},e.escapeFromProject=function(){n.escapeFromProject(a,c).then(function(){t.reload()})},s)var c=i.getToken().UserId;n.getProject(a).then(function(t){e.status=t.status,e.status?(e.project=t.data,e.projectTypes=e.project.ProjectType,e.projectIssues=e.project.Issues,0===e.project.ProjectMemberships.length&&(e.replacementText="В данный момент на проекте нет разработчиков."),e.checkMembership=function(){for(var t=!1,n=i.getToken().UserId,o=0;o<e.project.ProjectMemberships.length;o++)e.project.ProjectMemberships[o].DeveloperId===n&&(t=!0);return t},e.openViewerDialog=function(t){r.openedScreenshot=e.project.Screenshots[t],e.openViewer()},e.$emit("change_title",{title:e.project.Name+" - Лига Разработчиков НИТУ МИСиС"})):e.$emit("change_title",{title:"404 Not found - Лига Разработчиков НИТУ МИСиС"})}),e.$emit("toggle_black",{isBlack:!0})}]).controller("AdminPanelCtrl",["$scope","$state","TokenService",function(e,t,n){var o=n.getRole();if(1!=o)return t.go("index");e.$on("userRole_changed",function(e,r){if(1!=(o=n.getRole()))return t.go("index")}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Административная панель - Лига Разработчиков НИТУ МИСиС"})}]).controller("AllProjectsCtrl",["$scope","$state","ApiService","TokenService",function(e,t,n,o){var r=o.getToken(),i=o.getRole();if(!r||1!=i)return t.go("index");e.fullProjects=[],e.isMoreProjects=!0;var a=0;e.addProjects=function(){a++,e.updateProjects()},e.updateProjects=function(){n.getFullProjects(null,a).then(function(t){t&&0!==t.Data.length?(e.fullProjects=e.fullProjects.concat(t.Data),e.isMoreProjects=e.fullProjects.length<t.CountOfEntities):e.isMoreProjects=!1})},e.updateProjects(),e.$on("userRole_changed",function(e,n){if(1!=(i=o.getRole()))return t.go("index")}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Проекты - Лига Разработчиков НИТУ МИСиС"})}]).controller("AddProjectCtrl",["$scope","$state","ngDialog","ApiService","TokenService","$timeout",function(e,t,n,o,r,i){var a=r.getRole();if(1!=a)return t.go("index");var s=0;e.isInvalid=[],e.isOpen=!1,e.images=[],e.developers=[],e.chosenDevelopers=[],e.isMoreDevs=!0,e.currentState="filling",e.categories=[{category:"Веб",status:!1,index:0},{category:"Мобильное",status:!1,index:1},{category:"Десктопное",status:!1,index:2},{category:"Игра",status:!1,index:3},{category:"Прочее",status:!1,index:4}];var c=function(){this.Name="",this.ProjectTypes=[],this.Info="",this.AccessLevel="0",this.ProjectStatus=0,this.LandingImage={},this.Screenshots=[]};e.newProject=new c,e.toggleCategory=function(e){e.status=!e.status},e.resetPageCounter=function(){s=0,e.developers=[]},e.toggleOpened=function(){e.isOpen=!e.isOpen,e.isOpen?e.showFirstPage():e.resetPageCounter()};var l=function(e,t,n){var o,r=!1;n=!!n;for(o in t)if(n&&t[o]===e||!n&&t[o]==e){r=!0;break}return r};e.showFirstPage=function(){o.getFullDevelopers(s).then(function(t){if(e.developers=[],0==e.chosenDevelopers.length)return e.developers=e.developers.concat(t.Data),void(e.isMoreDevs=e.developers.length+e.chosenDevelopers.length<t.CountOfEntities);var n=t.Data.map(function(e){return e.UserId}),o=e.chosenDevelopers.map(function(e){return e.UserId});n=n.filter(function(e){return!l(e,o)}),t.Data=t.Data.filter(function(e){return l(e.UserId,n)}),0==t.Data.length?e.addDevelopers():e.developers=e.developers.concat(t.Data),e.isMoreDevs=e.developers.length+e.chosenDevelopers.length<t.CountOfEntities})},e.addDevelopers=function(){s++,o.getFullDevelopers(s).then(function(t){if(t&&0!==t.Data.length){if(0==e.chosenDevelopers.length)return e.developers=e.developers.concat(t.Data),void(e.isMoreDevs=e.developers.length+e.chosenDevelopers.length<t.CountOfEntities);var n=t.Data.map(function(e){return e.UserId}),o=e.chosenDevelopers.map(function(e){return e.UserId});n=n.filter(function(e){return!l(e,o)}),t.Data=t.Data.filter(function(e){return l(e.UserId,n)}),0==t.Data.length?e.addDevelopers():e.developers=e.developers.concat(t.Data),e.isMoreDevs=e.developers.length+e.chosenDevelopers.length<t.CountOfEntities}else e.isMoreDevs=!1})},e.$watch("searchText",function(t,n){""===t?(e.resetPageCounter(),e.showFirstPage()):t!==n&&o.getFullDevelopersBySearch(e.searchText).then(function(t){if(t.Message)e.resetPageCounter(),e.showFirstPage();else{e.isMoreDevs=!1;var n=t.map(function(e){return e.UserId}),o=e.chosenDevelopers.map(function(e){return e.UserId});n=n.filter(function(e){return!l(e,o)}),t=t.filter(function(e){return l(e.UserId,n)}),e.developers=t}})}),e.selectDeveloper=function(t){e.developers.forEach(function(e,n){e.isSelect=t==n,e.DeveloperRole=""})},e.chooseDeveloper=function(t){e.developers[t].DeveloperRole&&(e.chosenDevelopers.push({UserId:e.developers[t].UserId,FirstName:e.developers[t].FirstName,LastName:e.developers[t].LastName,Role:e.developers[t].DeveloperRole}),e.developers=[],e.toggleOpened())},e.deleteDeveloper=function(t){e.chosenDevelopers.splice(t,1)},e.currentUploadStateImage="waiting",e.currentPercentImage=0,e.$on("beforeSendImage",function(t,n){e.currentUploadStateImage="uploading",e.currentPercentImage=0,e.$apply()}),e.$on("errorUploadingImage",function(t,n){alert("Размер файла не должен превышать 10 Мб. Разрешённые форматы изображения: JPG, JPEG, PNG, SVG, BMP, GIF. Или, возможно, вы не авторизовались."),e.currentUploadStateImage="waiting",e.currentPercentImage=0,e.$apply()}),e.$on("progressImage",function(t,n){e.currentPercentImage=n.progress_value,e.$apply()}),e.$on("successUploadingImage",function(t,n){e.images.push({BigPhotoUri:"https://api.lod-misis.ru/image/"+n.data.BigPhotoName,SmallPhotoUri:"https://api.lod-misis.ru/image/"+n.data.SmallPhotoName}),e.currentUploadStateImage="waiting",e.$apply()}),e.deleteImage=function(t){e.images.splice(t,1)},e.currentUploadStateBigImage="waiting",e.currentPercentBigImage=0,e.$on("beforeSendBigImage",function(t,n){e.currentUploadStateBigImage="uploading",e.currentPercentBigImage=0,e.$apply()}),e.$on("errorUploadingBigImage",function(t,n){alert("Размер файла не должен превышать 10 Мб. Разрешённые форматы изображения: JPG, JPEG, PNG, SVG, BMP, GIF. Или, возможно, вы не авторизовались."),e.currentUploadStateBigImage="waiting",e.currentPercentBigImage=0,e.$apply()}),e.$on("progressBigImage",function(t,n){e.currentPercentBigImage=n.progress_value,e.$apply()}),e.$on("successUploadingBigImage",function(t,n){e.newProject.LandingImage={BigPhotoUri:"https://api.lod-misis.ru/image/"+n.data.BigPhotoName,SmallPhotoUri:"https://api.lod-misis.ru/image/"+n.data.SmallPhotoName},e.currentUploadStateBigImage="waiting",e.$apply()}),e.deleteBigImage=function(){e.newProject.LandingImage={}},e.registerProject=function(){e.newProject.Screenshots=e.images.map(function(e){return e});for(var t=0,n=0;n<e.categories.length;n++)e.categories[n].status&&(e.newProject.ProjectTypes[t]=n,t++);o.addProject(e.newProject).then(function(t){t.isSuccess?(e.currentState="success",e.chosenDevelopers.forEach(function(e){o.joinToProject(t.projectId,e.UserId,JSON.stringify(e.Role))}),s=0,e.images=[],e.developers=[],e.chosenDevelopers=[],e.isMoreDevs=!0,e.newProject=new c,e.categories=[{category:"Веб",status:!1,index:0},{category:"Мобильное",status:!1,index:1},{category:"Десктопное",status:!1,index:2},{category:"Игра",status:!1,index:3},{category:"Прочее",status:!1,index:4}],e.addProjectForm.$setPristine(),i(function(){e.currentState="filling"},3e3)):e.currentState="failed"})},e.$on("userRole_changed",function(e,n){if(1!=(a=r.getRole()))return t.go("index")}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Добавление проекта - Лига Разработчиков НИТУ МИСиС"})}]).controller("EditProjectCtrl",["$scope","$state","ApiService","TokenService","ngDialog","$timeout",function(e,t,n,o,r,i){var a=o.getRole();if(1!=a)return t.go("index");var s=t.params.id,c=0;e.developers=[],e.chosenDevelopers=[],e.isMoreDevs=!0,e.currentState="filling",e.editedProject={},e.categories=[{category:"Веб",status:!1,index:0},{category:"Мобильное",status:!1,index:1},{category:"Десктопное",status:!1,index:2},{category:"Игра",status:!1,index:3},{category:"Прочее",status:!1,index:4}],e.toggleCategory=function(e){e.status=!e.status},e.resetPageCounter=function(){c=0,e.developers=[]},e.toggleOpened=function(){e.isOpen=!e.isOpen,e.isOpen?e.showFirstPage():e.resetPageCounter()};var l=function(e,t,n){var o,r=!1;n=!!n;for(o in t)if(n&&t[o]===e||!n&&t[o]==e){r=!0;break}return r};e.showFirstPage=function(){n.getFullDevelopers(c).then(function(t){if(0==e.projectMemberships.length)return e.developers=e.developers.concat(t.Data),void(e.isMoreDevs=e.developers.length+e.projectMemberships.length<t.CountOfEntities);var n=t.Data.map(function(e){return e.UserId}),o=e.projectMemberships.map(function(e){return e.UserId});n=n.filter(function(e){return!l(e,o)}),t.Data=t.Data.filter(function(e){return l(e.UserId,n)}),0==t.Data.length?e.addDevelopers():e.developers=e.developers.concat(t.Data),e.isMoreDevs=e.developers.length+e.projectMemberships.length<t.CountOfEntities})},e.addDevelopers=function(){c++,n.getFullDevelopers(c).then(function(t){if(t&&0!==t.Data.length){if(0==e.projectMemberships.length)return e.developers=e.developers.concat(t.Data),void(e.isMoreDevs=e.developers.length+e.projectMemberships.length<t.CountOfEntities);var n=t.Data.map(function(e){return e.UserId}),o=e.projectMemberships.map(function(e){return e.UserId});n=n.filter(function(e){return!l(e,o)}),t.Data=t.Data.filter(function(e){return l(e.UserId,n)}),0==t.Data.length?e.addDevelopers():e.developers=e.developers.concat(t.Data),e.isMoreDevs=e.developers.length+e.projectMemberships.length<t.CountOfEntities}else e.isMoreDevs=!1})},e.$watch("searchText",function(t,o){""===t?(e.resetPageCounter(),e.showFirstPage()):t!==o&&n.getFullDevelopersBySearch(e.searchText).then(function(t){e.isMoreDevs=!1;var n=t.map(function(e){return e.UserId}),o=e.projectMemberships.map(function(e){return e.UserId});n=n.filter(function(e){return!l(e,o)}),t=t.filter(function(e){return l(e.UserId,n)}),e.developers=t})}),e.selectDeveloper=function(t){e.developers.forEach(function(e,n){e.isSelect=t==n,e.Role=""})},e.chooseDeveloper=function(t){e.developers[t].Role&&(e.projectMemberships.push(e.developers[t]),n.joinToProject(s,e.developers[t].UserId,JSON.stringify(e.developers[t].Role)),e.developers=[],e.toggleOpened())},e.deleteDeveloper=function(t){n.escapeFromProject(s,e.projectMemberships[t].UserId),e.projectMemberships.splice(t,1)},e.currentUploadStateImage="waiting",e.currentPercentImage=0,e.$on("beforeSendImage",function(t,n){e.currentUploadStateImage="uploading",e.currentPercentImage=0,e.$apply()}),e.$on("errorUploadingImage",function(t,n){alert("Размер файла не должен превышать 10 Мб. Разрешённые форматы изображения: JPG, JPEG, PNG, SVG, BMP, GIF. Или, возможно, вы не авторизовались."),e.currentUploadStateImage="waiting",e.currentPercentImage=0,e.$apply()}),e.$on("progressImage",function(t,n){e.currentPercentImage=n.progress_value,e.$apply()}),e.$on("successUploadingImage",function(t,n){e.editedProject.Screenshots.push({BigPhotoUri:"https://api.lod-misis.ru/image/"+n.data.BigPhotoName,SmallPhotoUri:"https://api.lod-misis.ru/image/"+n.data.SmallPhotoName}),e.currentUploadStateImage="waiting",e.$apply()}),e.deleteImage=function(t,n){e.editedProject.Screenshots.splice(n,1)},e.currentUploadStateBigImage="waiting",e.currentPercentBigImage=0,e.$on("beforeSendBigImage",function(t,n){e.currentUploadStateBigImage="uploading",e.currentPercentBigImage=0,e.$apply()}),e.$on("errorUploadingBigImage",function(t,n){alert("Размер файла не должен превышать 10 Мб. Разрешённые форматы изображения: JPG, JPEG, PNG, SVG, BMP, GIF. Или, возможно, вы не авторизовались."),e.currentUploadStateBigImage="waiting",e.currentPercentBigImage=0,e.$apply()}),e.$on("progressBigImage",function(t,n){e.currentPercentBigImage=n.progress_value,e.$apply()}),e.$on("successUploadingBigImage",function(t,n){e.editedProject.LandingImage={BigPhotoUri:"https://api.lod-misis.ru/image/"+n.data.BigPhotoName,SmallPhotoUri:"https://api.lod-misis.ru/image/"+n.data.SmallPhotoName},e.currentUploadStateBigImage="waiting",e.$apply()}),e.deleteBigImage=function(){e.editedProject.LandingImage={}},n.getProject(s).then(function(t){e.projectMemberships=t.data.ProjectMemberships.map(function(e){return{UserId:e.DeveloperId,FirstName:e.FirstName,LastName:e.LastName,Role:e.Role}}),e.editedProject.Name=t.data.Name,e.editedProject.ProjectTypes=t.data.ProjectType,e.editedProject.Info=t.data.Info,e.editedProject.AccessLevel=t.data.AccessLevel,e.editedProject.ProjectStatus=t.data.ProjectStatus,e.editedProject.LandingImage=t.data.LandingImage,e.editedProject.Screenshots=t.data.Screenshots;for(var n=0;n<e.editedProject.ProjectTypes.length;n++)e.categories[e.editedProject.ProjectTypes[n]].status=!0;e.$emit("change_title",{title:e.editedProject.Name+" - Лига Разработчиков НИТУ МИСиС"})}),e.editProject=function(){for(var t=0,o=0;o<e.categories.length;o++)e.categories[o].status&&(e.editedProject.ProjectTypes[t]=o,t++);n.editProject(s,e.editedProject).then(function(t){t?(e.currentState="success",i(function(){e.currentState="filling"},3e3)):e.currentState="failed"})},e.$on("userRole_changed",function(e,n){if(1!=(a=o.getRole()))return t.go("index")}),e.$emit("toggle_black",{isBlack:!0})}]).controller("AdminNotificationCtrl",["$scope","$timeout","ApiService","TokenService",function(e,t,n,o){var r=o.getToken(),i=o.getRole();if(!r||1!=i)return $state.go("index");e.createNotification=function(){n.createNotification(JSON.stringify(e.notification)).then(function(n){e.currentState=n?"success":"failed",e.notification="",t(function(){e.currentState=""},4e3)})},e.$on("userRole_changed",function(e,t){if(1!=(i=o.getRole()))return $state.go("index")}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Создание уведомления - Лига Разработчиков НИТУ МИСиС"})}]).controller("AdminDevelopersCtrl",["$scope","ApiService","DateService",function(e,t,n){e.developers=[],e.searchText="",e.isMoreDevs=!0,e.isOpen=!1;var o=0;e.resetPageCounter=function(){o=0},e.addDevelopers=function(){o++,t.getFullDevelopers(o).then(function(t){t&&0!==t.Data.length?(t.Data.forEach(function(t){e.developers.push({Name:t.LastName+" "+t.FirstName,UserId:t.UserId,RegistrationDate:n.getDDMMYYFromISODate(Date.parse(t.RegistrationDate)),ConfirmationStatus:t.ConfirmationStatus,IsHidden:t.IsHidden,AccountRole:t.AccountRole})}),e.isMoreDevs=e.developers.length<t.CountOfEntities):e.isMoreDevs=!1})},e.callConfirmationWindow=function(t,n,o){if(e.developerForConfirmation={id:t.UserId,name:t.Name,eventType:n,index:o},0==n&&1==e.developers[o].ConfirmationStatus)e.message=" будет подтверждён. Вы точно в этом уверены?";else if(1!=n||e.developers[o].AccountRole){if(2!=n)return;e.developers[o].IsHidden?e.message=" станет виден. Вы точно в этом уверены?":e.message=" будет скрыт. Вы точно в этом уверены?"}else e.message=" получит права администратора. Вы точно в этом уверены?";e.isOpen=!0},e.closeWindow=function(){e.isOpen=!1,e.developerForConfirmation={}},e.sendRequest=function(){switch(e.developerForConfirmation.eventType){case 0:t.confirmDeveloper(e.developerForConfirmation.id).then(function(t){t&&(e.developers[e.developerForConfirmation.index].ConfirmationStatus=2,e.developerForConfirmation={},e.closeWindow())});break;case 1:t.changeAccountRole(e.developerForConfirmation.id).then(function(t){t&&(e.developers[e.developerForConfirmation.index].AccountRole=1,e.developerForConfirmation={},e.closeWindow())});break;case 2:t.changeHidingStatus(e.developerForConfirmation.id,!e.developers[e.developerForConfirmation.index].IsHidden).then(function(t){t&&(e.developers[e.developerForConfirmation.index].IsHidden=!e.developers[e.developerForConfirmation.index].IsHidden,e.closeWindow())})}},e.$watch("searchText",function(r,i){""===r?(e.resetPageCounter(),e.developers=[],t.getFullDevelopers(o).then(function(t){t.Data.forEach(function(t){e.developers.push({Name:t.LastName+" "+t.FirstName,UserId:t.UserId,RegistrationDate:n.getDDMMYYFromISODate(Date.parse(t.RegistrationDate)),ConfirmationStatus:t.ConfirmationStatus,IsHidden:t.IsHidden,AccountRole:t.AccountRole})}),e.isMoreDevs=e.developers.length<t.CountOfEntities})):r!==i&&t.getFullDevelopersBySearch(e.searchText).then(function(t){e.isMoreDevs=!1,e.developers=[],t.forEach(function(t){e.developers.push({Name:t.LastName+" "+t.FirstName,UserId:t.UserId,RegistrationDate:n.getDDMMYYFromISODate(Date.parse(t.RegistrationDate)),ConfirmationStatus:t.ConfirmationStatus,IsHidden:t.IsHidden,AccountRole:t.AccountRole})})})}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Редактирование разработчиков - Лига Разработчиков НИТУ МИСиС"})}]).controller("SignupCtrl",["$scope","ApiService","$timeout",function(e,t,n){e.currentStates={},e.newDeveloper={},e.currentDate=new Date,e.signUp=function(){"github"===e.loginType?t.signUpWithGithub(e.newDeveloper):t.signUp(e.newDeveloper).then(function(t){e.currentStates={},t?200===t.status?e.currentStates.isSuccess=!0:409===t.status?e.currentStates.isRegisteredEmail=!0:e.currentStates.isFailed=!0:e.currentStates.isFailed=!0,e.currentStates.isSuccess&&(e.newDeveloper={},e.repeatedPassword=null,e.newDeveloper.Password=null,e.signForm.$setPristine(),n(function(){e.currentStates.isSuccess=null},4e3))})},e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Стать разработчиком - Лига Разработчиков НИТУ МИСиС"})}]).controller("AboutCtrl",["$scope",function(e){var t,n,o;ymaps.ready(function(){t=new ymaps.Map("map",{center:[55.72667388793981,37.60625375300586],zoom:17,size:[null,450],lang:"",type:"yandex#map",traffic:{shown:!1}},{suppressMapOpenBlock:!0}),n=new ymaps.GeoObjectCollection,o=[new ymaps.Placemark([55.726393150886125,37.606740556111525],{hintContent:"Лига Разработчиков (5й этаж, Г-588)",balloonContent:"Лига Разработчиков (5й этаж, Г-588)"},{preset:"islands#orangeDotIcon"}),new ymaps.GeoObject({geometry:{type:"LineString",coordinates:[[55.72696229923229,37.607824168555936],[55.726529384354315,37.606568894736974]]},properties:{hintContent:'Путь из корпуса "А"',balloonContent:'Путь из корпуса "А"'}},{strokeColor:"#177bc9",strokeWidth:5}),new ymaps.GeoObject({geometry:{type:"LineString",coordinates:[[55.72851118975991,37.60874775027792],[55.728526325960175,37.60895696258108],[55.72796628285632,37.60994401549855],[55.72665544769674,37.60768559550788],[55.72690066502515,37.607229619975406],[55.726534352164826,37.606559067721726]]},properties:{hintContent:"Путь от главного входа НИТУ МИСиС",balloonContent:"Путь от главного входа НИТУ МИСиС"}},{strokeColor:"#1e98ff",strokeWidth:5}),new ymaps.GeoObject({geometry:{type:"LineString",coordinates:[[55.72652303781649,37.60654812898927],[55.7264594624862,37.60643011179261]]}},{strokeColor:"#b3b3b3",strokeWidth:3}),new ymaps.GeoObject({geometry:{type:"LineString",coordinates:[[55.72690563942714,37.60720795240702],[55.72713874578818,37.60679489221874],[55.72670280548235,37.60600632276835],[55.726336490751585,37.60665541734995],[55.72639401146243,37.6067519768745]]},properties:{hintContent:"Проход через главный корпус Горного института (корпуса соединены проходом на втором и третьем этажах)",balloonContent:"Проход через главный корпус Горного института (корпуса соединены проходом на втором и третьем этажах)"}},{strokeColor:"#b3b3b3",strokeWidth:3})];for(var e=0;e<o.length;e++)n.add(o[e]);t.geoObjects.add(n)}),e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"О нас - Лига Разработчиков НИТУ МИСиС"})}]).controller("ContactCtrl",["$scope","ApiService",function(e,t){e.data={},e.Request=function(){t.contact(e.data).then(function(t){t?(e.isSuccess=t,e.ContactForm.$setPristine(),e.data={},setTimeout(function(){e.isSuccess=""},2e3)):alert("Что-то пошло не так.")})},e.$emit("toggle_black",{isBlack:!0}),e.$emit("change_title",{title:"Cвязаться - Лига Разработчиков НИТУ МИСиС"})}]).controller("LoginFormCtrl",["$scope","ApiService","$state","$timeout","NotificationsService",function(e,t,n,o,r){var i=(new Date).getHours();e.timeOfDay=i>4&&i<12?"morning":i>=12&&i<=18?"afternoon":i>18&&i<24?"evening":"night",e.isNoDeveloper=!1,e.userLogin={},e.status="loginForm",e.cons=function(){console.log(e.userLogin.emailForRecovery)},e.signIn=function(){t.signIn(e.userLogin).then(function(t){t?(e.userLogin={},e.loginForm.$setPristine(),e.closeThisDialog(".form__close-button"),r.startShowNotificationsAmount(),n.reload()):e.isNoDeveloper=!0})},e.signInWithGithub=function(){t.signInWithGithub()},e.toggleStatus=function(){e.status="loginForm"==e.status?"passwordRecovery":"loginForm"},e.recoverPassword=function(){t.getLinkForPasswordRecovery(e.userLogin.emailForRecovery).then(function(t){t&&(e.isSuccess=!0,e.userLogin.emailForRecovery="",o(function(){t=""},4e3))})}}]).controller("GithubLoginCtrl",["$scope","$state","$base64","ApiService","NotificationsService","TokenService",function(e,t,n,o,r,i){e.isNoDeveloper=!1,e.decodedToken=n.decode(t.params.encodedToken);var a=JSON.parse(e.decodedToken);i.setToken(a),t.go("index")}]).controller("EmailConfirmationCtrl",["$scope","ApiService","$state",function(e,t,n){var o=n.params.token;t.developerConfirmation(o).then(function(t){e.isSuccess=t}),e.$emit("toggle_black",{isBlack:!0})}]).controller("NotificationsCtrl",["$scope","$state","TokenService","ApiService",function(e,t,n,o){var r=n.getToken();if(!r)return t.go("index");var i=0;e.notifications={Read:[],Unread:[]};var a=function(e,t,n){var o,r=!1;n=!!n;for(o in t)if(n&&t[o]===e||!n&&t[o]==e){r=!0;break}return r},s=function(e){return e.Read.sort(function(e,t){return t.OccuredOn-e.OccuredOn}),e.Unread.sort(function(e,t){return t.OccuredOn-e.OccuredOn}),e},c=function(t){var n={Read:[],Unread:[]};n.Read=t.filter(function(e){return e.WasRead}),n.Unread=t.filter(function(e){return!e.WasRead});var o=n.Read.map(function(e){return e.Id}),r=n.Unread.map(function(e){return e.Id}),i=e.notifications.Read.map(function(e){return e.Id}),s=e.notifications.Unread.map(function(e){return e.Id});return o=o.filter(function(e){return!a(e,i)}),r=r.filter(function(e){return!a(e,s)}),n.Read=n.Read.filter(function(e){return a(e.Id,o)}),n.Unread=n.Unread.filter(function(e){return a(e.Id,r)}),n},l=function(e){return e=e.map(function(e){switch(e.EventType){case"NewEmailConfirmedDeveloper":o.getDeveloper(e.EventInfo.UserId).then(function(t){e.EventInfo.FirstName=t.data.FirstName,e.EventInfo.LastName=t.data.LastName});break;case"NewFullConfirmedDeveloper":o.getDeveloper(e.EventInfo.NewDeveloperId).then(function(t){e.EventInfo.FirstName=t.data.FirstName,e.EventInfo.LastName=t.data.LastName});break;case"NewContactMessage":e.EventInfo.ClientEmailAddress=e.EventInfo.ClientEmailAddress.Address;break;case"NewDeveloperOnProject":o.getDeveloper(e.EventInfo.UserId).then(function(t){e.EventInfo.FirstName=t.data.FirstName,e.EventInfo.LastName=t.data.LastName}),o.getProject(e.EventInfo.ProjectId).then(function(t){e.EventInfo.ProjectName=t.data.Name});break;case"NewProjectCreated":o.getProject(e.EventInfo.ProjectId).then(function(t){e.EventInfo.ProjectName=t.data.Name});break;case"DeveloperHasLeftProject":o.getDeveloper(e.EventInfo.NewDeveloperId).then(function(t){e.EventInfo.FirstName=t.data.FirstName,e.EventInfo.LastName=t.data.LastName})}})};e.addNotifications=function(){o.getNotifications(i).then(function(t){var n=c(t.Data),o={Read:e.notifications.Read.concat(n.Read),Unread:e.notifications.Unread.concat(n.Unread)};e.notifications=s(o),l(e.notifications.Read),l(e.notifications.Unread),e.isMoreNotif=e.notifications.Unread.length+e.notifications.Read.length<t.CountOfEntities,i++})},e.readNotifications=function(){var t=e.notifications.Unread.map(function(e){return e.Id});o.readNotifications(t).then(function(){e.notifications.Unread.forEach(function(e){e.WasRead=!0});var t=c(e.notifications.Unread),n={Read:e.notifications.Read.concat(t.Read),Unread:[]};e.notifications=s(n)})},e.addNotifications(),e.$on("userRole_changed",function(e,o){if(!(r=n.getToken())||!r.UserId)return t.go("index")}),e.$emit("change_title",{title:"Оповещения - Лига Разработчиков НИТУ МИСиС"}),e.$emit("toggle_black",{isBlack:!0})}]).controller("PasswordRecoveryCtrl",["$scope","ApiService","$state",function(e,t,n){e.data={Token:n.params.token,NewPassword:""},e.recoverPassword=function(){t.recoverPassword(e.data).then(function(t){e.isSuccess=t,e.data={Token:"",NewPassword:""},e.repeatedPassword=""})},e.$emit("change_title",{title:"Восстановление пароля - Лига Разработчиков НИТУ МИСиС"}),e.$emit("toggle_black",{isBlack:!0})}]),angular.module("LodSite.directives",[]).directive("pageHeader",function(){return{restrict:"EA",scope:!0,templateUrl:templateUrl("directives","page-header"),controller:"HeaderCtrl"}}).directive("pageFooter",function(){return{restrict:"E",scope:!0,templateUrl:templateUrl("directives","page-footer"),controller:"FooterCtrl"}}).directive("randomDevelopers",function(){return{restrict:"E",scope:!0,templateUrl:templateUrl("directives","random-developers"),controller:"RandomDevelopersCtrl"}}).directive("randomProjects",function(){return{restrict:"E",scope:!0,templateUrl:templateUrl("directives","random-projects"),controller:"RandomProjectsCtrl"}}).directive("uploadFile",["$rootScope","TokenService",function(e,t){return{resctrict:"A",link:function(n,o,r){var i=t.getToken();if(!i)return;var a=i.Token,s={};a&&(s.Authorization="Basic "+a);$(o[0]).ajaxUploadPrompt({url:"https://api.lod-misis.ru/file",headers:s,beforeSend:function(){e.$broadcast("beforeSend")},onprogress:function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.$broadcast("progress",{progress_value:Math.round(100*n)})}},error:function(){e.$broadcast("errorUploading")},success:function(t){e.$broadcast("successUploading",{data:t})}})}}}]).directive("dropzoneFile",["$rootScope","TokenService",function(e,t){return{resctrict:"A",link:function(n,o,r){var i=t.getToken();if(!i)return;var a=i.Token,s={};a&&(s.Authorization="Basic "+a);$(o[0]).ajaxUploadDrop({url:"https://api.lod-misis.ru/file",headers:s,beforeSend:function(){e.$broadcast("beforeSend")},onprogress:function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.$broadcast("progress",{progress_value:Math.round(100*n)})}},error:function(){e.$broadcast("errorUploading")},success:function(t){e.$broadcast("successUploading",{data:t})}})}}}]).directive("dropzoneImage",["$rootScope","TokenService",function(e,t){return{resctrict:"A",link:function(n,o,r){var i=t.getToken();if(!i)return;var a=i.Token,s={};a&&(s.Authorization="Basic "+a);$(o[0]).ajaxUploadDrop({url:"https://api.lod-misis.ru/image",headers:s,beforeSend:function(){e.$broadcast("beforeSendImage")},onprogress:function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.$broadcast("progressImage",{progress_value:Math.round(100*n)})}},error:function(){e.$broadcast("errorUploadingImage")},success:function(t){e.$broadcast("successUploadingImage",{data:t})}})}}}]).directive("uploadImage",["$rootScope","TokenService",function(e,t){return{resctrict:"A",link:function(n,o,r){var i=t.getToken();if(!i)return;var a=i.Token,s={};a&&(s.Authorization="Basic "+a);$(o[0]).ajaxUploadPrompt({url:"https://api.lod-misis.ru/image",headers:s,beforeSend:function(){e.$broadcast("beforeSendImage")},onprogress:function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.$broadcast("progressImage",{progress_value:Math.round(100*n)})}},error:function(){e.$broadcast("errorUploadingImage")},success:function(t){e.$broadcast("successUploadingImage",{data:t})}})}}}]).directive("dropzoneBigImage",["$rootScope","TokenService",function(e,t){return{resctrict:"A",link:function(n,o,r){var i=t.getToken();if(!i)return;var a=i.Token,s={};a&&(s.Authorization="Basic "+a);$(o[0]).ajaxUploadDrop({url:"https://api.lod-misis.ru/image",headers:s,beforeSend:function(){e.$broadcast("beforeSendBigImage")},onprogress:function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.$broadcast("progressBigImage",{progress_value:Math.round(100*n)})}},error:function(){e.$broadcast("errorUploadingBigImage")},success:function(t){e.$broadcast("successUploadingBigImage",{data:t})}})}}}]).directive("uploadBigImage",["$rootScope","TokenService",function(e,t){return{resctrict:"A",link:function(n,o,r){var i=t.getToken();if(!i)return;var a=i.Token,s={};a&&(s.Authorization="Basic "+a);$(o[0]).ajaxUploadPrompt({url:"https://api.lod-misis.ru/image",headers:s,beforeSend:function(){e.$broadcast("beforeSendBigImage")},onprogress:function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.$broadcast("progressBigImage",{progress_value:Math.round(100*n)})}},error:function(){e.$broadcast("errorUploadingBigImage")},success:function(t){e.$broadcast("successUploadingBigImage",{data:t})}})}}}]).directive("slideToggle",function(){return{restrict:"A",scope:{},controller:function(e){},link:function(e,t,n){t.bind("click",function(){var e=angular.element(n.slideToggle),t=parseInt(n.slideToggleDuration,10)||200;e.stop().slideToggle(t)})}}}),angular.module("LodSite.services",[]).service("TokenService",["$rootScope",function(e){var t=this;this.setToken=function(t){localStorage.setItem("authorization_token",JSON.stringify(t)),e.$emit("userRole_changed",{userRole:t.Role})},this.getToken=function(){return JSON.parse(localStorage.getItem("authorization_token"))},this.refreshTokenDate=function(){var e=new Date,n=t.getToken();n&&(n.CreationTime=e.toISOString(),t.setToken(n))},this.resetToken=function(){localStorage.removeItem("authorization_token"),e.$emit("userRole_changed",{userRole:t.getRole()})},this.getRole=function(){var e=t.getToken();return!!e&&((new Date).getMilliseconds()-Date.parse(e.CreationTime)>864e5?(t.resetToken(),!1):(t.refreshTokenDate(),e.Role))}}]).service("ApiService",["$http","TokenService","DateService","$rootScope","$timeout","$window",function(e,t,n,o,r){var i="get",a="post",s="put",c=function(t,n,o,r,i){var a={method:t,url:n};return i&&(a.headers={Authorization:"Basic "+i}),o&&(a.params=o),r&&(a.data=r),e(a)},l=function(e,n,i,a){var s=API_DOMAIN_URL+n;if(!1!==t.getRole())var l=t.getToken().Token;var u=c(e,s,i,a,l);return r(function(){!1!==o.dataLoading&&(o.dataLoading=!0)},150),u.then(function(e){return t.refreshTokenDate(),e},function(n){return 401===n.status?(t.resetToken(),c(e,s,i,a,null).then(function(e){return t.refreshTokenDate(),e},function(){return!1})):n}).then(function(e){return o.dataLoading=!1,e})};this.getRandomDevelopers=function(e){return l(i,"/developers/random/"+e).then(function(e){return e.data})},this.getFullDevelopers=function(e){return l(i,"/developers?page="+e).then(function(e){return{Data:n.getFormattedTimeDevsList(e.data.Data),CountOfEntities:e.data.CountOfEntities}})},this.getFullDevelopersBySearch=function(e){return l(i,"/developers/search/"+e).then(function(e){return n.getFormattedTimeDevsList(e.data)})},this.getDeveloper=function(e){return l(i,"/developers/"+e).then(function(e){if(200===e.status){var t=new Date,o=e.data;return o.studyingYear=t.getFullYear()-e.data.StudentAccessionYear||1,o.IsGraduated&&(o.studyingYear="Закончил(а) обучение"),{data:n.getFormattedTimeDev(o),status:200===e.status}}return{status:200===e.status}})},this.getRedirectionToAuthenticationGithubForm=function(){return l(i,"/auth/github").then(function(e){window.location.href=e.data})},this.getDeveloperForProfileSttings=function(e){return l(i,"/developers/"+e).then(function(e){return e.data})},this.sendProfileSttings=function(e,t){return l(s,"/developers/"+e,null,t).then(function(e){return 200===e.status})},this.getNotificationsForProfileSttings=function(e){return l(i,"/developers/notificationsettings/"+e).then(function(e){return e.data})},this.sendNotifications=function(e,t){return l(s,"/developers/notificationsettings/"+e,null,t).then(function(e){return 200===e.status})},this.sendNewPassword=function(e){return l(s,"/password",null,e).then(function(e){return 200===e.status})},this.developerConfirmation=function(e){return l(a,"/developers/confirmation/"+e,null).then(function(e){return 200===e.status})},this.confirmDeveloper=function(e){return l(a,"/admin/developers/confirm/"+e,null).then(function(e){return 200===e.status})},this.changeAccountRole=function(e){return l(a,"/admin/"+e,null).then(function(e){return 200===e.status})},this.changeHidingStatus=function(e,t){return l(a,"/admin/developers/"+e+"/hide/"+t,null).then(function(e){return 200===e.status})},this.getRandomProjects=function(e){return l(i,"/projects/random/"+e).then(function(e){return e.data})},this.getFullProjects=function(e,t){return l(i,"/projects?page="+t,e).then(function(e){return e.data})},this.getProject=function(e){return l(i,"/projects/"+e).then(function(e){return{data:e.data,status:200===e.status}})},this.addProject=function(e){return l(a,"/projects",null,e).then(function(e){return{isSuccess:200===e.status,projectId:e.data}})},this.editProject=function(e,t){return l(s,"/projects/"+e,null,t).then(function(e){return 200===e.status})},this.joinToProject=function(e,t,n){return l(a,"/projects/"+e+"/developer/"+t,null,n)},this.escapeFromProject=function(e,t){return l("delete","/projects/"+e+"/developer/"+t)},this.getNotifications=function(e){return l(i,"/event/"+e).then(function(e){var t=e.data;return function(e){for(var t=0;t<e.length;t++)e[t].OccuredOn=Date.parse(e[t].OccuredOn),e[t].Time=n.getHHmmFromISODate(e[t].OccuredOn),e[t].Date=n.getDDMMYYFromISODate(e[t].OccuredOn),e[t].EventInfo=JSON.parse(e[t].EventInfo)}(t.Data),t})},this.readNotifications=function(e){return l(s,"/event/read",null,e)},this.getNotificationsAmount=function(){return l(i,"/event/count").then(function(e){return e.data},function(){return 0})},this.createNotification=function(e){return l(a,"/admin/notification",null,e)},this.signUp=function(e){return l(a,"/developers",null,JSON.stringify(e)).then(function(e){return e})},this.signUpWithGithub=function(e){return l(a,"/signup/github",null,JSON.stringify(e)).then(function(e){window.location.href=e.data})},this.signIn=function(e){return l(a,"/login",null,e).then(function(e){return 200===e.status&&t.setToken(e.data),200===e.status})},this.signInWithGithub=function(){return l(i,"/login/github").then(function(e){window.location.href=e.data})},this.getLinkForPasswordRecovery=function(e){return l(a,"/password/recovery",null,JSON.stringify({Email:e})).then(function(e){return 200===e.status})},this.recoverPassword=function(e){return l(s,"/password",null,e).then(function(e){return 200===e.status})},this.getFile=function(e){var t="/file/"+e;e.match(/[^\.]*$/)[0];return l(i,t).then(function(t){var n=document.createElement("a"),o=new Blob([t.data],{type:"application/octet-stream"});return n.href=URL.createObjectURL(o),n.download=e,n.click(),t.data})},this.contact=function(e){return l(a,"/contact",null,e).then(function(e){return 200===e.status})}}]).service("DateService",[function(){var e=this;this.getHHmmFromISODate=function(e){var t=new Date(e),n=t.getHours(),o=t.getMinutes();return n<10&&(n="0"+n),o<10&&(o="0"+o),n+":"+o},this.getDDMMYYFromISODate=function(e){var t=new Date(e),n=t.getDate(),o=t.getMonth()+1,r=t.getFullYear()%100;return n<10&&(n="0"+n),o<10&&(o="0"+o),r<10&&(r="0"+r),n+"."+o+"."+r},this.getFormattedTimeDev=function(t){return t.residenceTime=e.getFormattedTime(t.RegistrationDate),t},this.getFormattedTimeDevsList=function(t){for(var n=0;n<t.length;n++)t[n].residenceTime=e.getFormattedTime(t[n].RegistrationDate);return t},this.getFormattedTime=function(t){var n=e.getResidenceTimeObject(t),o="Первый день",r=n.days-30*n.months,i=n.months-12*n.years,a=p(n.days,[" день"," дня"," дней"]),s=p(n.weeks,[" неделю"," недели"," недель"]),c=p(n.months,[" месяц"," месяца"," месяцев"]),l=p(n.years,[" год"," года"," лет"]),u=p(r,[" день"," дня"," дней"]),d=p(i,[" месяц"," месяца"," месяцев"]);function p(e,t){return t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]}return n.days<20&&0!==n.days&&(o=n.days+a),n.weeks&&(o=n.weeks+s),n.months&&(o=0===r?n.months+c:n.months+c+" и "+r+u),n.years&&(o=0===i?n.years+l:n.years+l+" и "+i+d),o},this.getResidenceTimeObject=function(e){var t=864e5,n=new Date,o=Date.parse(n)-Date.parse(e),r={};return r.days=Math.floor(o/t),r.weeks=Math.floor(o/t/7),r.months=Math.floor(o/t/30),r.years=Math.floor(o/t/30/12),r}}]).service("NotificationsService",["$rootScope","ApiService",function(e,t){function n(){t.getNotificationsAmount().then(function(t){e.notificationsAmount=t})}var o;this.startShowNotificationsAmount=function(){n(),o=setInterval(n,5e3)},this.stopShowNotificationsAmount=function(){clearInterval(o)}}]);